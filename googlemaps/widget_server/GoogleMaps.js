(function () {    // populate the 'data' object    // e.g., data.table = $sp.getValue('table');    var table = $sp.getValue('table'),        filter = $sp.getValue('filter'),        order = $sp.getValue('order_by'),        order_direction = $sp.getValue('order_direction'),        fields = String($sp.getValue('field_list')),        size = $sp.getValue('maximum_entries') || 10,        fields_array = fields.split(',');    if (!options.latitude_field || !options.longitude_field)        return;    if (fields_array.indexOf(options.latitude_field) == -1) {        fields_array.push(options.latitude_field);    }    if (fields_array.indexOf(options.longitude_field) == -1) {        fields_array.push(options.longitude_field);    }    var gr = new GlideRecordSecure(table);    if (!gr.isValid()) {        data.invalid_table = true;        data.table = table;        return;    }    if (filter)        gr.addEncodedQuery(filter);    if (order_direction) {        if (order_direction == "asc")            gr.orderBy(order);        else            gr.orderByDesc(order);    }    gr.chooseWindow(0, size);    gr.query();    var list = [];    while (gr.next()) {        var record = {};        record.sys_id = gr.getValue('sys_id');        $sp.getRecordElements(record, gr, fields_array.join(','));        record.position = {};        record.position.lat = Number(record.latitude.value);        record.position.lng = Number(record.longitude.value);        list.push(record);    }    data.locations = list;    data.key = options.api_key || gs.getProperty('google.maps.key');})();